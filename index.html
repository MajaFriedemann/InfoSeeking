<!DOCTYPE html>
<html lang="eng-UK">
<head>
    <!--meta data-->
    <meta name="robots" content="noindex">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.ico?" type="image/x-icon" />
    <title>DOTS TASK</title>
    <meta name="description" content="UIDMUL-IST1">
    <meta name="author" content="Maja Friedemann (GitHub: https://github.com/MajaFriedemann | email: maja.friedemann@gmail.com)">
    <!--link to AWS/Stitch/MongoDB-->
    <script src="https://s3.amazonaws.com/stitch-sdks/js/library/v3/stable/stitch.min.js"></script>
    <!--jQuery and jQuery plugins -->
    <script src="scripts/external/jquery.min.js"></script>
    <script src="scripts/external/jquery-3.3.1.js"></script>
    <script src="scripts/external/jquery-ui.min.js"></script>
    <script src="scripts/external/jquery.mousewheel.min.js"></script>
    <script src="scripts/external/jquery.scrollify.js"></script>
    <!--jsPsych-->
    <script src="scripts/external/jspsych-6.0.2.js"></script>
    <!--staircase-->
    <script src="scripts/external/Staircase.js"></script>
    <!--Intro.js library-->
    <script src="scripts/external/intro-custom.js"></script>
    <link href="styles/external/introjs.min.css" rel="stylesheet" type="text/css">
    <!--math & stats functions-->
    <script src="scripts/external/seedrandom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/6.2.2/math.js"></script>
    <!--Modernizr-->
    <script src="scripts/external/modernizr-UIDMUL-IST-180521.js"></script>
    <!--custom CSS-->
    <link href="https://use.typekit.net/ivu3ect.css" rel="stylesheet">
    <link href="styles/style.css" rel="stylesheet" type="text/css">
    <!--custom JS: helper functions-->
    <script src="scripts/helper.js"></script>
    <script src="scripts/squircles.js"></script>
    <!--custom JS: trials using jPsych-->
    <script src="scripts/jpsych/jspsych-consent.js"></script>
    <script src="scripts/jpsych/jspsych-debriefing.js"></script>
    <script src="scripts/jpsych/jspsych-demographics.js"></script>
    <script src="scripts/jpsych/jspsych-squircles.js"></script>
    <script src="scripts/jpsych/jspsych-feedback-form.js"></script>
    <script src="scripts/jpsych/jspsych-loading.js"></script>
    <script src="scripts/jpsych/jspsych-message-splash.js"></script>
    <script src="scripts/jpsych/jspsych-notice.js"></script>
    <script src="scripts/jpsych/jspsych-PIS.js"></script>
    <script src="scripts/jpsych/jspsych-score-reveal.js"></script>
</head>

<body></body>

<script>
    /* The following are global variables (available across plugins).
    (note: these must be declared directly in <script> and not within $(document).ready)
    */

    /* PROLIFIC PARAMETERS */

    var ProlificID = getUrlVars()['PROLIFIC_PID'];
    console.log(ProlificID);
    // NOTE ADD COMPLETION CODE HERE!
    var completionCode = "DEE7049F";
    var completionURL = "https://app.prolific.ac/submissions/complete?cc=" + completionCode;
    var PHQexclusionURL = "https://app.prolific.ac/submissions/complete?cc=EXCLU001";

    /* EXPERIMENT INFORMATION */

    var subjectID;
    var studyName = 'Information seeking & confidence';
    var version = 'first pilot';
    var release_date = '2020/07/30';
    var trialTypeOrder = 'all';    /* "testing" or "all"*/
    var cohort = 'PR';             /*PR for prolific*/
    var CUREC_studyName = 'Contextual influences on metacognitive judgements';
    var CUREC_ID = 'R67369/RE001';
    var CUREC_version = '5.0';
    var CUREC_date = '2018/11/12';
    var consent_version = '1.0';
    var consent_date = '2020/01/01';
    var PIS_version = '1.0';
    var PIS_date = '2020/01/01';
    var startExperiment = Date.now();
    var currentAttempt = 1;


    /* SEEDED RANDOMISATION
    Get the random subject identifier from cookies, or if there isn't one, set one and make a cookie with the random subject identifier to expire within the year */
    if (getCookie('UIDMUL-IST-subjectID')) {
        subjectID = getCookie('UIDMUL-IST-subjectID');
        //up the number of attempts
        existingAttempts = Number(getCookie('UIDMUL-IST-attempts'));
        currentAttempt = 1 + existingAttempts;
        setCookie('UIDMUL-IST-attempts', currentAttempt, 365);
    } else {
        subjectID = genRandIdentifier(9);
        setCookie('UIDMUL-IST-subjectID', subjectID, 365);
        setCookie('UIDMUL-IST-attempts', currentAttempt, 365);
    }

    // seed the randomisations (whenever a random number is generated it is seeded to the subjectID so that it is reproducible)
    // removing all non-digits from string
    var seed = subjectID.replace(/\D/g,'');
    seed = parseInt(seed);
    Math.seedrandom(seed);


    /* IMAGES TO PRELOAD */
    var images = [
        'assets/oxford-logo.jpg',
        'assets/checkmark-white.svg',
        'assets/checkmark-black.svg',
        'assets/down-arrow-2.svg',
        'assets/up-arrow.svg',
        'assets/dotTask_2.5.0 practice.gif',
        'assets/dotTask_2.4.0.gif',
        'assets/dotTask_2.6.0.gif',
        'assets/partner.png',
    ];


    /* DATA VARIABLES */
    var blockCount = 0;
    var blockCounter = 0;

    var totalTrials = 0;
    var trialsPerBlock = 20; //make trial count 20 here (5x20 trials = 100 trials per partner)

    var totalCorrect = 0;
    var cumulativeScore = 0;
    var accuracy = 0;
    var overallAccuracy = 0;

    var bonusPayment = 0;

    var dataObject = {
        trial_count: [],
        block_count: [],
        subjectID: subjectID,
        prolificID: ProlificID,
        experiment_version: version,
        experiment_version_date: release_date,
        experiment_condition: undefined,
        trialType_order: trialTypeOrder,
        attempts: currentAttempt,

        CUREC_ID: CUREC_ID,
        CUREC_version: CUREC_version,
        CUREC_date: CUREC_date,
        PIS_version: PIS_version,
        PIS_date: PIS_date,
        PIS_acknowledged: undefined,
        consent_version: consent_version,
        consent_date: consent_date,
        consented: undefined,

        age: undefined,
        gender: undefined,
        handedness: undefined,
        demographicsRTs: [],
        demographics_duration: 0,

        accuracy: [],
        isTutorialMode: [],
        moreRedSide: [],
        confidences: [],
        partner_confidences: [],
        meanColorPairs: [],
        moreAsked: [],
        isCorrect: [],
        RTs: [],
        waitTimes: [],

        technical_issues: undefined,
        feedback_technical: undefined,
        feedback_comments: undefined,
        debriefing: undefined,

    };


    /* EXPERIMENTAL PAGES */

    // ethics
    var PIS = {
        type: 'jspsych-PIS',
        studyName: studyName,
        CUREC_ID: CUREC_ID,
        version: PIS_version,
        date: PIS_date
    };

    var consent = {
        type: 'jspsych-consent',
        studyName: studyName,
        CUREC_ID: CUREC_ID,
        version: consent_version,
        date: consent_date
    };

    var debriefing = {
        type: 'jspsych-debriefing',
        studyName: studyName,
        CUREC_ID: CUREC_ID,
        version: CUREC_version,
        date: CUREC_date
    };

    // demographics
    var demographics = {
        type: 'jspsych-demographics'
    };


    // task
    var Practice = {
        type: 'jspsych-squircles',
        dot_minimum: 200,
        canvasWidth: 500,
        canvasHeight: 180,
        leftColor: 'rgb(255,255,255)',
        rightColor: 'rgb(255,255,255)',
        waitTimeLimit: 2000,
        isTutorialMode: true,
        trial_count: 100,             //make trial count 100 here
        yellowButtonEnabled: false,
        greenButtonName: 'CONTINUE',
        seeAgain: 'practice1',
        partner: 'none',
    };

    var Task1 = {
        type: 'jspsych-squircles',
        dot_minimum: 200,
        canvasWidth: 500,
        canvasHeight: 180,
        leftColor: 'rgb(255,255,255)',
        rightColor: 'rgb(255,255,255)',
        waitTimeLimit: 2000,
        isTutorialMode: false,
        trial_count: trialsPerBlock,
        blockCounterEnabled: true,
        greenButtonName: 'CONTINUE',
        seeAgain: 'easier',
        partner: 'underconfident'
    };

    var Task2 = {
        type: 'jspsych-squircles',
        dot_minimum: 200,
        canvasWidth: 500,
        canvasHeight: 180,
        leftColor: 'rgb(255,255,255)',
        rightColor: 'rgb(255,255,255)',
        waitTimeLimit: 2000,
        isTutorialMode: false,
        trial_count: trialsPerBlock,
        blockCounterEnabled: true,
        greenButtonName: 'CONTINUE',
        seeAgain: 'easier',
        partner: 'overconfident'
    };


    var Instructions1 = {
        type: 'jspsych-notice',
        section1_text: 'In this experiment, you will be playing a game with dots.',
        section2_text: 'During this game, you will see two boxes containing dots briefly flash on either side of the centre of the screen (marked with a "+" sign). Your task is to decide whether the left or right box contains more dots. If you think the left box contained more dots, you respond with a <u>left mouse-click</u>. If you think the right box contained more dots, you respond with a <u>right mouse-click</u>. The task will start off quite easy <u>but will become harder</u> as you progress. ' +
            '<br><br> Press the "continue" button to start the game. <u>The first phase of the game can take up to 8 minutes.</u> You should reach a stable performance level to continue to the next phase.',
        img_id: 'dotTask-gif1'
    };

    var Instructions2 = {
        type: 'jspsych-notice',
        section1_text: 'From now on, you will indicate your confidence in your decisions.',
        section2_text: 'After responding with a left or right click, you will now <u>indicate your confidence</u> in the decision <u>on a sliding scale</u>. Hover over the slider bar to change the slider position - towards the middle if you aren\'t sure of your answer, and towards the left/right side if you\'re confident that the respective side is the correct answer - then click on the slider bar to register your confidence rating. ' +
            ' <br><br>Press the "continue" button to do a few trials with the confidence slider.',
        img_id: 'dotTask-gif2'
    };


    var Start = {
        type: 'jspsych-notice',
        section1_text: 'You have now completed the first two phases of the dot game.',
        section2_text: 'For the rest of the experiment, you\'ll be doing the task you just practiced. However, from now on you will see the response of another past participant for the same dots-grid. Your partner did about as well as you did in the practice trials. <br><br><highlight style="color: rgb(13,255,146)">You will earn points depending on whether your response is correct and how accurate your confidence judgment was.</highlight> At the end of the game, we will take all trials where you indicated, for example, a confidence of 70-80% and check if in fact 70-80% of those trials were correct. The closer your confidence judgements align with your actual accuracy, the higher your cash bonus will be at the end of the experiment, so <highlight style="color: rgb(13,255,146)">you will earn more with more accurate confidence judgments</highlight>. <br><br>There will be 10 blocks of 20 trials, which should take approximately 25 minutes to complete altogether. Press "continue" to continue to the first block of 20 trials',
        img_id: 'dotTask-gif3'
    };

    var Rest = {
        type: 'jspsych-message-splash',
        name: 'dotTaskRest',
        subjectID: subjectID,
        message: '',
        variableMessage: 'dotRest flat',
        backgroundColor: 'rgb(0,0,0)',
        buttonEnabled: true,
        buttonText: 'CONTINUE',
        lineSpacing: '130%',
        submessageSize: '2.8vmin'
    };


    var ScoreReveal = {
        type: 'jspsych-score-reveal',
        performanceType: 'Brier',
        bonusThreshold: 60,
        flatBonusAmount: 1
    };

    var thankYou = {
        type: 'jspsych-message-splash',
        name: 'thankYou',
        message: 'Thank you for completing the study! <br> <h4>You will now be returned to Prolific for your participant payment. If you are not automatically redirected in 2 seconds, please click <a href="' + completionURL + '">here</a>.</h4>',
        endPage: true,
        subjectID: subjectID
    };

    var loading = {
        type: 'jspsych-loading',
        subjectID: subjectID
    };

    var questionnaireSplash = {
        type: 'jspsych-message-splash',
        name: 'questionnaireIntro',
        message: 'The experiment starts with a few questions for you.',
        subjectID: subjectID,
        buttonEnabled: true
    };

    var feedbackPoll = {
        type: 'jspsych-feedback-form',
        askStrategy: false
    };



    /* TIMELINES FOR RELEASE & TESTING */
    switch(trialTypeOrder) {
        case 'all':
            var timeline = [
                // loading,
                // PIS,
                // consent,
                // demographics,
                Instructions1,
                Practice,
                Instructions2,
                //Start,
                Task2,
                ScoreReveal,
                feedbackPoll,
                debriefing,
                thankYou
            ];
            break;

        case 'testing':
            var timeline = [
                Instructions1,
                thankYou
            ];
            break;

        default:
            var timeline = [loading];
    }

    /* JSPSYCH*/

    jsPsych.init({
        timeline: timeline,
        preload_images: images,
        show_preload_progress_bar: false, // hide preload progress bar
        on_finish: function() {
            var endExperiment = Date.now();
            var testTime = msToMinSec(endExperiment - startExperiment);
            // add all experimental details to dataObject
            dataObject["staircase"] = dotsStaircase.get('logSpace');
            dataObject["overallAccuracy"] = overallAccuracy;
            dataObject["bonus_earned"] = bonusPayment;
            dataObject["date_completed"] = longformDate();
            dataObject["duration"] = testTime;

            saveCSV(subjectID, currentAttempt);

        }
    });
</script>
</html>